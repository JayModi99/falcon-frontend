<h2 mat-dialog-title>{{ data.type }} Ticket</h2>
<mat-dialog-content class="mat-typography">
    <form style="text-align: center;" [formGroup]="ticketForm">

        <mat-form-field style="width: 90%;" appearance="">
            <mat-label>Client</mat-label>
            <mat-select (selectionChange)="onClientChange($event)" formControlName="client_id" required>
                <mat-option *ngIf="!problem" disabled>Failed to Load</mat-option>
                <mat-option *ngFor="let c of clients" [value]="c.id">
                    {{c.organisation_name}}
                </mat-option>
            </mat-select>
            <mat-error *ngIf="ticketForm.get('client_id').hasError('required')">
                Client is required
            </mat-error>
        </mat-form-field>
        <mat-icon (click)="openClientAddDialog('Add', 0, '')" style="cursor: pointer;">add</mat-icon>
        
        <mat-form-field style="width: 90%;" appearance="">
            <mat-label>Problem</mat-label>
            <mat-select formControlName="problem_id" required>
                <mat-option *ngIf="!problem" disabled>Failed to Load</mat-option>
                <mat-option *ngFor="let p of problem" [value]="p.id">
                    {{p.problem_name}}
                </mat-option>
            </mat-select>
            <mat-error *ngIf="ticketForm.get('problem_id').hasError('required')">
                Problem is required
            </mat-error>
        </mat-form-field>
        <mat-icon (click)="openProblemAddDialog()" style="cursor: pointer;">add</mat-icon>

        <mat-form-field style="width: 90%;" appearance="">
            <mat-label>Product</mat-label>
            <mat-select formControlName="client_product_id" required>
                <mat-option *ngIf="loading" disabled>Loading...</mat-option>
                <mat-option *ngIf="!clientProduct" disabled>No Product Found</mat-option>
                <mat-option *ngFor="let c of clientProduct" [value]="c.id">
                    {{ c.product_category }} - {{c.name}}
                </mat-option>
            </mat-select>
            <mat-error *ngIf="ticketForm.get('client_product_id').hasError('required')">
                Product is required
            </mat-error>
        </mat-form-field>
        <mat-icon (click)="openClientProductAddDialog()" style="cursor: pointer;">add</mat-icon>

        <mat-form-field style="width: 100%;" appearance="">
            <mat-label>Details</mat-label>
            <input matInput formControlName="details" required>
            <mat-icon matSuffix class="secondary-text">description</mat-icon>
            <mat-error *ngIf="ticketForm.get('details').hasError('required')">
                Details is required
            </mat-error>
        </mat-form-field>

    </form>
</mat-dialog-content>
<mat-dialog-actions align="end">
  <button mat-button [mat-dialog-close]="0">Cancel</button>
  <button (click)="addTicket()" [disabled]="ticketForm.invalid" mat-flat-button color="accent">{{ data.type }}</button>
</mat-dialog-actions>
<div class="overlay" *ngIf="loading">
  <div class="spinner">
    <mat-spinner color="accent"></mat-spinner>
  </div>
</div>
