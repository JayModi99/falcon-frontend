<h2 mat-dialog-title>{{ data.type }} Product to Client</h2>
<mat-dialog-content class="mat-typography">
    <form style="text-align: center;" [formGroup]="clientProductForm">

        <table style="width: 100%; border: none;">
            <tr>
                <td style="width: 50%; text-align: center; border: none;">
                    <mat-form-field style="width: 85%;" appearance="">
                        <mat-label>Product Category</mat-label>
                        <mat-select (selectionChange)="onProductCategoryChange($event.value)" formControlName="category_id" required>
                            <mat-option *ngIf="!productCategory" disabled>Failed to Load</mat-option>
                            <mat-option *ngFor="let category of productCategory" [value]="category.id">
                                {{category.product_category}}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="clientProductForm.get('category_id').hasError('required')">
                            Product Category is required
                        </mat-error>
                    </mat-form-field>
                    <mat-icon (click)="openProductCategoryAddDialog()" style="cursor: pointer;">add</mat-icon>
                </td>
                <td style="width: 50%; text-align: center; border: none;">
                    <mat-form-field style="width: 85%;" appearance="">
                        <mat-label>Products</mat-label>
                        <mat-select formControlName="product_id" required>
                            <mat-option *ngIf="loading" disabled>Loading...</mat-option>
                            <mat-option *ngIf="productFailed" disabled>Failed to Load</mat-option>
                            <mat-option *ngIf="!loading && !productFailed && product == ''" disabled>No Product Found</mat-option>
                            <mat-option *ngFor="let p of product" [value]="p.id">
                                {{p.name}}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="clientProductForm.get('product_id').hasError('required')">
                            Product is required
                        </mat-error>
                    </mat-form-field>
                    <mat-icon *ngIf="clientProductForm.get('category_id').value" (click)="openProductAddDialog()" style="cursor: pointer;">add</mat-icon>
                    <mat-icon *ngIf="!clientProductForm.get('category_id').value" style="cursor: default;">add</mat-icon>
                </td>
            </tr>
        </table>

        <mat-form-field style="width: 100%;" appearance="">
            <mat-label>Contract Type</mat-label>
            <mat-select (selectionChange)="contractTypeChange()" formControlName="contract_type" required>
                <mat-option value="Warranty">Warranty</mat-option>
                <mat-option value="Non Warranty">Non Warranty</mat-option>
                <mat-option value="AMC">AMC</mat-option>
            </mat-select>
            <mat-error *ngIf="clientProductForm.get('contract_type').hasError('required')">
                Contract Type is required
            </mat-error>
        </mat-form-field>

        <table style="width: 100%; border: none;">
            <tr>
                <td style="width: 50%; text-align: center; border: none;">
                    <mat-form-field appearance="">
                        <mat-label>Contract Start Date</mat-label>
                        <input formControlName="contract_start" matInput [matDatepicker]="datepickerStart" required>
                        <mat-datepicker-toggle matSuffix [for]="datepickerStart"></mat-datepicker-toggle>
                        <mat-datepicker #datepickerStart>
                        </mat-datepicker>
                        <mat-error *ngIf="clientProductForm.get('contract_start').hasError('required')">
                            Start Date is required
                        </mat-error>
                    </mat-form-field>
                </td>
                <td style="width: 50%; text-align: center; border: none;">
                    <mat-form-field appearance="">
                        <mat-label>Contract End Date</mat-label>
                        <input formControlName="contract_end" matInput [matDatepicker]="datepickerEnd" [min]="clientProductForm.get('contract_start').value" required>
                        <mat-datepicker-toggle matSuffix [for]="datepickerEnd"></mat-datepicker-toggle>
                        <mat-datepicker #datepickerEnd>
                        </mat-datepicker>
                        <mat-error *ngIf="clientProductForm.get('contract_end').hasError('required')">
                            End Date is required
                        </mat-error>
                    </mat-form-field>
                </td>
            </tr>
        </table>

        <mat-form-field style="width: 100%;" appearance="">
            <mat-label>Details</mat-label>
            <input matInput formControlName="details" required>
            <mat-icon matSuffix class="secondary-text">description</mat-icon>
            <mat-error *ngIf="clientProductForm.get('details').hasError('required')">
                Details is required
            </mat-error>
        </mat-form-field>

    </form>
</mat-dialog-content>
<mat-dialog-actions align="end">
  <button mat-button [mat-dialog-close]="0">Cancel</button>
  <button (click)="addClientProduct()" [disabled]="clientProductForm.invalid" mat-flat-button color="accent">{{ data.type }}</button>
</mat-dialog-actions>
<div class="overlay" *ngIf="loading">
  <div class="spinner">
    <mat-spinner color="accent"></mat-spinner>
  </div>
</div>
